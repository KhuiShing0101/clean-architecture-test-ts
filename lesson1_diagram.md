# Lesson 1: Book Registration - Architecture Flow Diagram

## Overview

**Lesson 1: Book Registration System**
- **Focus**: Basic Clean Architecture structure
- **Domain**: Book Entity + ISBN Value Object
- **Pattern**: Repository pattern with dependency inversion
- **Use Case**: Register a new book with ISBN validation

---

## Complete Architecture Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LESSON 1: BOOK REGISTRATION                         â”‚
â”‚                    Domain: Book Entity + ISBN Value Object                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         PRESENTATION LAYER (Future)                       â•‘
â•‘                                                                           â•‘
â•‘  POST /api/books                                                          â•‘
â•‘  {                                                                        â•‘
â•‘    "isbn": "978-0134685991",                                             â•‘
â•‘    "title": "Clean Architecture",                                        â•‘
â•‘    "author": "Robert Martin"                                             â•‘
â•‘  }                                                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                        â”‚
                                        â”‚ HTTP Request
                                        â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          APPLICATION LAYER                                â•‘
â•‘                                                                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚  RegisterBookUseCase.execute(input)                              â”‚    â•‘
â•‘  â”‚                                                                   â”‚    â•‘
â•‘  â”‚  Step 1: Validate ISBN Format                                    â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚    â•‘
â•‘  â”‚  â”‚ const isbnVO = new ISBN(input.isbn)      â”‚â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â•‘
â•‘  â”‚  â”‚ // Throws if invalid format              â”‚       â”‚           â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚           â”‚    â•‘
â•‘  â”‚                                                      â”‚           â”‚    â•‘
â•‘  â”‚  Step 2: Check ISBN Uniqueness                      â”‚           â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚           â”‚    â•‘
â•‘  â”‚  â”‚ const existing = await                   â”‚       â”‚           â”‚    â•‘
â•‘  â”‚  â”‚   bookRepository.findByISBN(isbnVO)      â”‚â”€â”€â”€â”   â”‚           â”‚    â•‘
â•‘  â”‚  â”‚ if (existing) throw Error                â”‚   â”‚   â”‚           â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚           â”‚    â•‘
â•‘  â”‚                                                  â”‚   â”‚           â”‚    â•‘
â•‘  â”‚  Step 3: Create Book Entity                     â”‚   â”‚           â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚           â”‚    â•‘
â•‘  â”‚  â”‚ const book = Book.create(                â”‚   â”‚   â”‚           â”‚    â•‘
â•‘  â”‚  â”‚   isbn, title, author                    â”‚â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”       â”‚    â•‘
â•‘  â”‚  â”‚ )                                        â”‚   â”‚   â”‚   â”‚       â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚   â”‚       â”‚    â•‘
â•‘  â”‚                                                  â”‚   â”‚   â”‚       â”‚    â•‘
â•‘  â”‚  Step 4: Persist                                â”‚   â”‚   â”‚       â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚   â”‚       â”‚    â•‘
â•‘  â”‚  â”‚ await bookRepository.save(book)          â”‚â”€â”€â”€â”¼â”€â”€â”€â”˜   â”‚       â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚       â”‚    â•‘
â•‘  â”‚                                                  â”‚       â”‚       â”‚    â•‘
â•‘  â”‚  Step 5: Return DTO                             â”‚       â”‚       â”‚    â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚       â”‚    â•‘
â•‘  â”‚  â”‚ return { bookId, isbn, title, ... }      â”‚   â”‚       â”‚       â”‚    â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚       â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                        â”‚ â”‚       â”‚       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚       â”‚
                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚       â”‚
                    â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                    â”‚   â”‚   â”‚                             â”‚
                    â–¼   â–¼   â–¼                             â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                            DOMAIN LAYER                                   â•‘
â•‘                     (Pure Business Logic - No Dependencies)               â•‘
â•‘                                                                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚  Value Object            â”‚  â”‚  Entity                             â”‚   â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â•‘
â•‘  â”‚  â”‚ ISBN               â”‚â—„â”€â”¼â”€â”€â”¼â”€â”€â”¤ Book                          â”‚  â”‚   â•‘
â•‘  â”‚  â”‚                    â”‚  â”‚  â”‚  â”‚                               â”‚  â”‚   â•‘
â•‘  â”‚  â”‚ - value: string    â”‚  â”‚  â”‚  â”‚ - id: string                 â”‚  â”‚   â•‘
â•‘  â”‚  â”‚                    â”‚  â”‚  â”‚  â”‚ - isbn: ISBN â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”
â•‘  â”‚  â”‚ Methods:           â”‚  â”‚  â”‚  â”‚ - title: string              â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ âœ“ cleanISBN()      â”‚  â”‚  â”‚  â”‚ - author: string             â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ âœ“ isValid()        â”‚  â”‚  â”‚  â”‚ - status: BookStatus         â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ âœ“ validateISBN10() â”‚  â”‚  â”‚  â”‚ - createdAt: Date            â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ âœ“ validateISBN13() â”‚  â”‚  â”‚  â”‚ - updatedAt: Date            â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ âœ“ getValue()       â”‚  â”‚  â”‚  â”‚                               â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ âœ“ equals()         â”‚  â”‚  â”‚  â”‚ Factory Methods:             â”‚  â”‚  â”‚
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚ âœ“ create() â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ âœ“ reconstruct()              â”‚  â”‚  â”‚
â•‘                                â”‚  â”‚                               â”‚  â”‚  â”‚
â•‘                                â”‚  â”‚ Business Logic:               â”‚  â”‚  â”‚
â•‘                                â”‚  â”‚ âœ“ borrow()                    â”‚  â”‚  â”‚
â•‘                                â”‚  â”‚ âœ“ returnBook()                â”‚  â”‚  â”‚
â•‘                                â”‚  â”‚ âœ“ reserve()                   â”‚  â”‚  â”‚
â•‘                                â”‚  â”‚ âœ“ cancelReservation()         â”‚  â”‚  â”‚
â•‘                                â”‚  â”‚ âœ“ canBorrow()                 â”‚  â”‚  â”‚
â•‘                                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â•‘                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â•‘                                                                         â”‚
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â•‘  â”‚  Repository Interface (Contract)                                  â”‚  â”‚
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â•‘  â”‚  â”‚ IBookRepository                                             â”‚  â”‚  â”‚
â•‘  â”‚  â”‚                                                             â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ Methods:                                                    â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ - save(book: Book): Promise<void>                          â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ - findById(id: string): Promise<Book | null>               â”‚  â”‚  â”‚
â•‘  â”‚  â”‚ - findByISBN(isbn: ISBN): Promise<Book | null> â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”˜
â•‘  â”‚  â”‚ - findAll(): Promise<Book[]>                               â”‚  â”‚
â•‘  â”‚  â”‚ - delete(id: string): Promise<void>                        â”‚  â”‚
â•‘  â”‚  â”‚ - findByStatus(status: string): Promise<Book[]>            â”‚  â”‚
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                        â–²
                                        â”‚ implements
                                        â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                       INFRASTRUCTURE LAYER                                â•‘
â•‘                  (External Dependencies - Database, APIs)                 â•‘
â•‘                                                                           â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚  MySQLBookRepository implements IBookRepository                  â”‚   â•‘
â•‘  â”‚                                                                   â”‚   â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â•‘
â•‘  â”‚  â”‚ - prisma: PrismaClient                                      â”‚ â”‚   â•‘
â•‘  â”‚  â”‚                                                             â”‚ â”‚   â•‘
â•‘  â”‚  â”‚ save(book: Book): Promise<void> {                          â”‚ â”‚   â•‘
â•‘  â”‚  â”‚   await prisma.book.upsert({                               â”‚ â”‚   â•‘
â•‘  â”‚  â”‚     where: { id: book.id },                                â”‚ â”‚   â•‘
â•‘  â”‚  â”‚     update: { title, author, status, ... },                â”‚ â”‚   â•‘
â•‘  â”‚  â”‚     create: { id, isbn, title, author, ... }               â”‚ â”‚   â•‘
â•‘  â”‚  â”‚   })                                                        â”‚ â”‚   â•‘
â•‘  â”‚  â”‚ }                                                           â”‚ â”‚   â•‘
â•‘  â”‚  â”‚                                                             â”‚ â”‚   â•‘
â•‘  â”‚  â”‚ findByISBN(isbn: ISBN): Promise<Book | null> {             â”‚ â”‚   â•‘
â•‘  â”‚  â”‚   const record = await prisma.book.findUnique({            â”‚ â”‚   â•‘
â•‘  â”‚  â”‚     where: { isbn: isbn.getValue() }                       â”‚ â”‚   â•‘
â•‘  â”‚  â”‚   })                                                        â”‚ â”‚   â•‘
â•‘  â”‚  â”‚   return record ? this.toDomain(record) : null             â”‚ â”‚   â•‘
â•‘  â”‚  â”‚ }                                                           â”‚ â”‚   â•‘
â•‘  â”‚  â”‚                                                             â”‚ â”‚   â•‘
â•‘  â”‚  â”‚ private toDomain(record): Book {                           â”‚ â”‚   â•‘
â•‘  â”‚  â”‚   // Convert database record â†’ domain entity               â”‚ â”‚   â•‘
â•‘  â”‚  â”‚   const isbnVO = new ISBN(record.isbn)                     â”‚ â”‚   â•‘
â•‘  â”‚  â”‚   return Book.reconstruct(id, isbnVO, title, ...)          â”‚ â”‚   â•‘
â•‘  â”‚  â”‚ }                                                           â”‚ â”‚   â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                        â”‚
                                        â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   PostgreSQL Database â”‚
                            â”‚                       â”‚
                            â”‚   Table: books        â”‚
                            â”‚   - id                â”‚
                            â”‚   - isbn (unique)     â”‚
                            â”‚   - title             â”‚
                            â”‚   - author            â”‚
                            â”‚   - status            â”‚
                            â”‚   - created_at        â”‚
                            â”‚   - updated_at        â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Dependency Flow (Clean Architecture Rule)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPENDENCY DIRECTION                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Presentation â†’ Application â†’ Domain â† Infrastructure
    â†“              â†“           â†‘            â†‘
  (API/UI)    (Use Cases)  (Entities)  (Database)

âœ… Dependencies point INWARD (toward Domain)
âœ… Domain has ZERO external dependencies
âœ… Infrastructure implements Domain interfaces
```

---

## Step-by-Step Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. API REQUEST                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

POST /api/books
{
  "isbn": "978-0134685991",
  "title": "Clean Architecture",
  "author": "Robert Martin"
}

                    â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. USE CASE EXECUTION - RegisterBookUseCase.execute()           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Create ISBN Value Object                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
const isbnVO = new ISBN("978-0134685991")
    â†“
âœ“ Cleans input: removes hyphens/spaces
âœ“ Validates format: checks 10 or 13 digits
âœ“ Validates check digit: mathematical validation
âœ“ Result: ISBN{ value: "9780134685991" }

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Check ISBN Uniqueness                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
const existingBook = await bookRepository.findByISBN(isbnVO)
    â†“
IBookRepository Interface â†’ MySQLBookRepository Implementation
    â†“
Prisma Query: SELECT * FROM books WHERE isbn = '9780134685991'
    â†“
Result: null (not found) âœ“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Create Book Entity                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
const book = Book.create(isbn, title, author)
    â†“
âœ“ Validates title not empty
âœ“ Validates author not empty
âœ“ Creates ISBN Value Object
âœ“ Generates UUID for id
âœ“ Sets status to AVAILABLE
âœ“ Sets timestamps
    â†“
Result: Book{
  id: "a1b2c3d4-...",
  isbn: ISBN("9780134685991"),
  title: "Clean Architecture",
  author: "Robert Martin",
  status: AVAILABLE,
  createdAt: 2025-11-11T...,
  updatedAt: 2025-11-11T...
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Persist to Repository                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
await bookRepository.save(book)
    â†“
IBookRepository Interface â†’ MySQLBookRepository Implementation
    â†“
Prisma Query:
INSERT INTO books (id, isbn, title, author, status, created_at, updated_at)
VALUES ('a1b2c3d4-...', '9780134685991', 'Clean Architecture', ...)
    â†“
âœ“ Book saved to database

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Return DTO (Data Transfer Object)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
return {
  bookId: "a1b2c3d4-...",
  isbn: "9780134685991",
  title: "Clean Architecture",
  author: "Robert Martin",
  status: "AVAILABLE",
  createdAt: 2025-11-11T...
}

                    â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. API RESPONSE                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HTTP 201 Created
{
  "bookId": "a1b2c3d4-...",
  "isbn": "9780134685991",
  "title": "Clean Architecture",
  "author": "Robert Martin",
  "status": "AVAILABLE",
  "createdAt": "2025-11-11T..."
}
```

---

## Clean Architecture Principles Applied

### 1. Domain Independence

```
âœ… Book Entity
   - No import from Prisma
   - No import from Express
   - No import from any framework
   - Only imports UUID library and own Value Objects

âœ… ISBN Value Object
   - Pure TypeScript class
   - Zero external dependencies
   - Self-contained validation logic
```

### 2. Dependency Inversion

```
âœ… Application Layer depends on IBookRepository (interface)
   NOT on MySQLBookRepository (concrete implementation)

// RegisterBookUseCase.ts
constructor(private readonly bookRepository: IBookRepository) {}
                                            â†‘
                                         Interface
                                      (defined in Domain)

âœ… Infrastructure implements Domain interface
// MySQLBookRepository.ts
export class MySQLBookRepository implements IBookRepository {
                                            â†‘
                                    Implements contract
                                  defined by Domain layer
```

### 3. Single Responsibility

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component             â”‚ Responsibility                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ISBN                 â”‚ Validate ISBN format only               â”‚
â”‚ Book                 â”‚ Encapsulate book business logic         â”‚
â”‚ IBookRepository      â”‚ Define data access contract             â”‚
â”‚ RegisterBookUseCase  â”‚ Orchestrate book registration workflow  â”‚
â”‚ MySQLBookRepository  â”‚ Implement database operations           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Testability

```
âœ… Can test Book entity without database
âœ… Can test ISBN validation in isolation
âœ… Can test RegisterBookUseCase with mock repository
âœ… Can swap database implementation without changing domain

Example:
const mockRepo = {
  findByISBN: jest.fn().mockResolvedValue(null),
  save: jest.fn()
};
const useCase = new RegisterBookUseCase(mockRepo);
await useCase.execute({ isbn, title, author });
```

### 5. Replaceability

```
âœ… Can swap MySQLBookRepository with:
   - MongoBookRepository
   - InMemoryBookRepository
   - RedisBookRepository

WITHOUT changing:
   - Domain layer (Book, ISBN, IBookRepository)
   - Application layer (RegisterBookUseCase)
```

---

## File Structure

```
src/
â”œâ”€â”€ domain/                          # Pure business logic
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â””â”€â”€ Book.ts                  # Book entity with business methods
â”‚   â”œâ”€â”€ valueObjects/
â”‚   â”‚   â””â”€â”€ ISBN.ts                  # ISBN value object with validation
â”‚   â””â”€â”€ repositories/
â”‚       â””â”€â”€ IBookRepository.ts       # Repository interface (contract)
â”‚
â”œâ”€â”€ application/                     # Use cases (workflows)
â”‚   â””â”€â”€ useCases/
â”‚       â””â”€â”€ RegisterBookUseCase.ts   # Book registration orchestration
â”‚
â””â”€â”€ infrastructure/                  # External dependencies
    â””â”€â”€ persistence/
        â””â”€â”€ MySQLBookRepository.ts   # Prisma/PostgreSQL implementation

prisma/
â””â”€â”€ schema.prisma                    # Database schema
```

---

## Key Takeaways

### âœ… What Lesson 1 Teaches:

1. **Clean Architecture Layers**: Separation of concerns across 4 layers
2. **Value Objects**: Immutable, self-validating objects (ISBN)
3. **Entities**: Domain objects with identity and business logic (Book)
4. **Repository Pattern**: Abstract data access with interfaces
5. **Dependency Inversion**: Depend on abstractions, not concretions
6. **Factory Methods**: Control object creation (Book.create())
7. **Domain Validation**: Business rules in domain layer (ISBN validation)

### ğŸ“Š Complexity Level: â­â­ (Basic)

- Simple entity with basic business logic
- One value object (ISBN)
- Standard CRUD operations
- Straightforward validation rules

### ğŸ¯ Learning Goals Achieved:

- [x] Understand Clean Architecture layer separation
- [x] Implement repository pattern
- [x] Create value objects with validation
- [x] Use factory methods for entity creation
- [x] Apply dependency inversion principle
- [x] Keep domain pure (no framework dependencies)
